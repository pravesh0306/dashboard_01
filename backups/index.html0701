<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Fashion Admin Dashboard</title>
  
  <!-- PWA and Mobile Meta Tags -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#51946b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Fashion Admin">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link
    rel="stylesheet"
    as="style"
    onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
  />
  
  <!-- Styles and Scripts -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="stylesheet" href="style.css?v=mobile-green-1.0.0">
  
  <!-- Extension Conflict Handler to prevent browser extension errors from affecting the app -->
  <script src="extension-conflict-handler.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // Enhanced cache management and performance monitoring
    console.log('üöÄ Loading Google Drive Pro Dashboard v8 - Cache timestamp:', Date.now());
    
    // Performance monitoring
    const perfStart = performance.now();
    
    // Advanced cache clearing
    if ('caches' in window) {
      caches.keys().then(names => {
        names.forEach(name => {
          if (name.includes('gdrive-dashboard') && !name.includes('v8')) {
            caches.delete(name);
            console.log('üóëÔ∏è Deleted old cache:', name);
          }
        });
      });
    }
    
    // Clear old localStorage entries
    if (localStorage.getItem('app_version') !== 'v8') {
      console.log('üîÑ Upgrading localStorage to v8');
      localStorage.setItem('app_version', 'v8');
    }
    
    // Log performance when page loads
    window.addEventListener('load', () => {
      const loadTime = performance.now() - perfStart;
      console.log(`‚ö° Page loaded in ${loadTime.toFixed(2)}ms`);
    });
  </script>
  <script>
    // Embedded Google Drive Storage Manager
    const GOOGLE_DRIVE_CONFIG = Object.freeze({
      CLIENT_ID: '742085206847-n89sirj5uo2dsep5rlpo5h5ce125hkqk.apps.googleusercontent.com',
      SCOPES: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email',
      FOLDER_ID: '',
    });

    class GoogleDriveStorageManager {
      constructor() {
        this.isReady = false;
        this.accessToken = null;
        this.tokenExpiresAt = 0;
        this.authPromiseResolvers = null;
        this.currentAuthPromise = null;
        this.tokenClient = null;
        this.storageKey = 'google_drive_auth';
        this.restoreAuthState();
      }

      async initialize() {
        if (this.isReady) return;
        await this.loadGIS();
        this.initializeTokenClient();
        this.isReady = true;
      }

      saveAuthState() {
        if (this.accessToken && this.tokenExpiresAt > Date.now()) {
          const authData = {
            accessToken: this.accessToken,
            tokenExpiresAt: this.tokenExpiresAt
          };
          localStorage.setItem(this.storageKey, JSON.stringify(authData));
        } else {
          localStorage.removeItem(this.storageKey);
        }
      }

      saveUserProfile(profile) {
        localStorage.setItem(this.storageKey + '_profile', JSON.stringify(profile));
      }

      getSavedUserProfile() {
        try {
          const stored = localStorage.getItem(this.storageKey + '_profile');
          return stored ? JSON.parse(stored) : null;
        } catch (error) {
          console.warn('Failed to get saved user profile:', error);
          return null;
        }
      }      restoreAuthState() {
        try {
          const stored = localStorage.getItem(this.storageKey);
          console.log('Checking localStorage for auth data:', stored ? 'Found' : 'Not found');
          
          if (stored) {
            const authData = JSON.parse(stored);
            console.log('Parsed auth data:', { 
              tokenPresent: !!authData.accessToken,
              expiresAt: new Date(authData.tokenExpiresAt),
              now: new Date(),
              isValid: authData.tokenExpiresAt > Date.now() 
            });
            
            if (authData.tokenExpiresAt > Date.now()) {
              this.accessToken = authData.accessToken;
              this.tokenExpiresAt = authData.tokenExpiresAt;
              console.info('‚úÖ Restored authentication state from localStorage');
            } else {
              localStorage.removeItem(this.storageKey);
              console.info('‚ùå Removed expired authentication state');
            }
          }
        } catch (error) {
          console.warn('Failed to restore authentication state:', error);
          localStorage.removeItem(this.storageKey);
        }
      }

      loadGIS() {
        return new Promise((resolve, reject) => {
          if (window.google && window.google.accounts) {
            resolve();
            return;
          }
          const script = document.createElement('script');
          script.src = 'https://accounts.google.com/gsi/client';
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      initializeTokenClient() {
        this.tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: GOOGLE_DRIVE_CONFIG.CLIENT_ID,
          scope: GOOGLE_DRIVE_CONFIG.SCOPES,
          callback: (response) => {
            if (response && response.access_token) {
              console.log('Token received/refreshed:', response);
              this.accessToken = response.access_token;
              const expiresInSeconds = response.expires_in ? parseInt(response.expires_in, 10) : 3500;
              this.tokenExpiresAt = Date.now() + (expiresInSeconds * 1000);
              this.saveAuthState();
              if (this.authPromiseResolvers) {
                this.authPromiseResolvers.resolve(true);
              }
            } else {
              const errorMsg = response.error || 'Google authentication failed: No access token received.';
              console.error('Token callback error:', response);
              if (this.authPromiseResolvers) {
                this.authPromiseResolvers.reject(new Error(errorMsg));
              }
            }
            this.authPromiseResolvers = null;
          }
        });
      }

      async authenticate() {
        await this.initialize();
        if (this.accessToken && Date.now() < this.tokenExpiresAt) {
          console.log('Using existing valid token.');
          return true;
        }
        if (this.currentAuthPromise) {
          console.log('Authentication already in progress, awaiting existing promise.');
          return this.currentAuthPromise;
        }
        console.log('Requesting new access token.');
        this.currentAuthPromise = new Promise((resolve, reject) => {
          this.authPromiseResolvers = { resolve, reject };
          if (google.accounts.oauth2.hasGrantedAllScopes(this.tokenClient, GOOGLE_DRIVE_CONFIG.SCOPES)) {
            this.tokenClient.requestAccessToken({});
          } else {
            this.tokenClient.requestAccessToken({ prompt: 'consent' });
          }
        }).finally(() => {
          this.currentAuthPromise = null;
        });
        return this.currentAuthPromise;
      }

      async uploadFile(file, fileName, onProgress = null) {
        if (!this.isReady) await this.initialize();
        if (!this.accessToken || Date.now() >= this.tokenExpiresAt) {
          await this.authenticate();
        }
        const metadata = {
          name: fileName,
          mimeType: file.type || 'application/octet-stream',
          ...(GOOGLE_DRIVE_CONFIG.FOLDER_ID ? { parents: [GOOGLE_DRIVE_CONFIG.FOLDER_ID] } : {})
        };
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        form.append('file', file);
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.upload.onprogress = (e) => {
            if (e.lengthComputable && onProgress) {
              onProgress((e.loaded / e.total) * 100);
            }
          };
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              const result = JSON.parse(xhr.responseText);
              resolve({
                id: result.id,
                name: result.name,
                url: `https://drive.google.com/file/d/${result.id}/view`,
                downloadUrl: `https://www.googleapis.com/drive/v3/files/${result.id}?alt=media`,
                size: file.size,
                type: file.type,
                provider: 'googledrive',
                uploadedAt: new Date(),
                fileId: result.id
              });
            } else {
              let errorMsg = 'Google Drive upload failed';
              try {
                const errorObj = JSON.parse(xhr.responseText);
                if (errorObj.error && errorObj.error.message) {
                  errorMsg += `: ${errorObj.error.message} (Status: ${xhr.status})`;
                } else {
                  errorMsg += `: ${xhr.responseText}`;
                }
              } catch (e) {
                errorMsg += `: ${xhr.responseText}`;
              }
              reject(new Error(errorMsg));
            }
          };
          xhr.onerror = () => reject(new Error('Network error during upload'));
          xhr.open('POST', 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart');
          xhr.setRequestHeader('Authorization', `Bearer ${this.accessToken}`);
          xhr.send(form);
        });
      }

      async downloadFile(fileId, fileName) {
        if (!this.isReady) await this.initialize();
        if (!this.accessToken || Date.now() >= this.tokenExpiresAt) {
          await this.authenticate();
        }
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.responseType = 'blob';
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              const blob = xhr.response;
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = fileName || 'download';
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              resolve(true);
            } else {
              reject(new Error(`Download failed: ${xhr.status} ${xhr.statusText}`));
            }
          };
          xhr.onerror = () => reject(new Error('Network error during download'));
          xhr.open('GET', `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`);
          xhr.setRequestHeader('Authorization', `Bearer ${this.accessToken}`);
          xhr.send();
        });
      }

      async getUserProfile() {
        if (!this.isReady) await this.initialize();
        if (!this.accessToken || Date.now() >= this.tokenExpiresAt) {
          await this.authenticate();
        }
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              const profile = JSON.parse(xhr.responseText);
              this.saveUserProfile(profile);
              resolve(profile);
            } else {
              reject(new Error(`Failed to get user profile: ${xhr.status} ${xhr.statusText}`));
            }
          };
          xhr.onerror = () => reject(new Error('Network error getting user profile'));
          xhr.open('GET', 'https://www.googleapis.com/oauth2/v2/userinfo');
          xhr.setRequestHeader('Authorization', `Bearer ${this.accessToken}`);
          xhr.send();
        });
      }

      isAuthenticated() {
        return this.accessToken && Date.now() < this.tokenExpiresAt;
      }

      logout() {
        const token = this.accessToken;
        this.accessToken = null;
        this.tokenExpiresAt = 0;
        localStorage.removeItem(this.storageKey);
        localStorage.removeItem(this.storageKey + '_profile');
        if (token && window.google && window.accounts && window.accounts.oauth2) {
          try {
            google.accounts.oauth2.revoke(token);
          } catch (error) {
            console.warn('Failed to revoke token:', error);
          }
        }
      }
    }

    // Initialize Google Drive storage manager
    const cloudStorage = new GoogleDriveStorageManager();
    console.log('cloudStorage initialized:', cloudStorage);
  </script>
  <!-- Fix: Top Right Search/Filter Box -->
  <style>
    .dashboard-search-box {
      background: #fff;
      color: #22223b;
      border: 1.5px solid #c3cfe2;
      border-radius: 0.7rem;
      padding: 0.7rem 1.1rem;
      font-size: 1rem;
      outline: none;
      transition: border 0.16s;
      margin-top: 0.2rem;
      box-shadow: 0 2px 8px 0 rgba(30, 34, 90, 0.04);
    }
    .dashboard-search-box:focus {
      border: 1.5px solid #6a82fb;
      background: #fff;
    }
    .order-details-form {
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
      background: #fff;
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px 0 rgba(30, 34, 90, 0.08);
      padding: 2rem 1.5rem;
      margin-top: 1rem;
      max-width: 480px;
    }
    .order-details-form label {
      font-size: 0.98rem;
      font-weight: 500;
      color: #6a82fb;
      margin-bottom: 0.3rem;
    }
    .order-details-form input,
    .order-details-form select {
      border: 1.5px solid #c3cfe2;
      border-radius: 0.7rem;
      padding: 0.7rem 1.1rem;
      font-size: 1rem;
      background: #f5f7fa;
      color: #22223b;
      outline: none;
      transition: border 0.16s;
    }
    .order-details-form input:disabled,
    .order-details-form select:disabled {
      background: #f5f7fa;
      color: #888;
      opacity: 1;
    }
    .order-details-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.2rem;
      justify-content: flex-end;
    }
    .order-btn {
      border: none;
      border-radius: 0.75rem;
      padding: 0.6rem 1.4rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, box-shadow 0.18s;
      box-shadow: 0 2px 8px 0 rgba(30, 34, 90, 0.06);
    }
    .order-btn.edit { background: linear-gradient(90deg, #6a82fb 0%, #fc5c7d 100%); color: #fff; }
    .order-btn.delete { background: #f87171; color: #fff; }
    .order-btn.save { background: #10b981; color: #fff; }
    .order-btn.cancel { background: #f5f7fa; color: #6a82fb; border: 1px solid #c3cfe2; }
    .order-btn:disabled { opacity: 0.6; cursor: not-allowed; }
  </style>
</head>
<body>  <!-- Login Page -->
  <div id="loginPage" class="relative flex size-full min-h-screen flex-col bg-gradient-to-br from-indigo-50 via-white to-cyan-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <!-- Background Pattern -->
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxwYXR0ZXJuIGlkPSJkb3RzIiB4PSIwIiB5PSIwIiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICA8Y2lyY2xlIGN4PSIxIiBjeT0iMSIgcj0iMSIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIwLjA1Ii8+CiAgICA8L3BhdHRlcm4+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0idXJsKCNkb3RzKSIvPgo8L3N2Zz4=')] opacity-30"></div>
    
    <div class="layout-container flex h-full grow flex-col relative z-10">
      <!-- Header Logo -->
      <div class="flex justify-center pt-8">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white">
              <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <span class="text-xl font-bold text-gray-900">Fashion Admin</span>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex flex-1 justify-center items-center px-4 sm:px-6 lg:px-8">
        <div class="w-full max-w-md space-y-8">
          <!-- Welcome Card -->
          <div class="bg-white/80 backdrop-blur-sm shadow-xl rounded-2xl border border-white/50 p-8">
            <!-- Header -->
            <div class="text-center mb-8">
              <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome Back</h1>
              <p class="text-gray-600">Sign in to your Fashion Admin Dashboard</p>
            </div>

            <!-- Features List -->
            <div class="space-y-4 mb-8">
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                </div>
                <span class="text-gray-700 text-sm">Secure Google Drive Integration</span>
              </div>
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                  </svg>
                </div>
                <span class="text-gray-700 text-sm">File Upload & Management</span>
              </div>
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                  </svg>
                </div>
                <span class="text-gray-700 text-sm">Order & Customer Management</span>
              </div>
            </div>

            <!-- Sign In Button -->
            <button
              id="loginBtn"
              class="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="w-5 h-5 mr-3">
              <span>Sign in with Google Drive</span>
            </button>

            <!-- Status Message -->
            <div id="loginStatus" class="text-center mt-4 text-sm min-h-[20px]"></div>
          </div>

          <!-- Footer -->
          <div class="text-center">
            <p class="text-xs text-gray-500">
              Secure authentication powered by Google Identity Services
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>  <!-- Main App Layout -->
  <div id="appContainer" class="relative flex size-full min-h-screen flex-col bg-[#f8fbfa] group/design-root overflow-x-hidden" style="display:flex; font-family: Inter, 'Noto Sans', sans-serif;">
    <div class="flex h-full grow">
      <!-- Sidebar (Reference Design Style) -->
      <div id="sidebar" class="sidebar">
        <div class="flex flex-col gap-4">
          <h1 class="text-[#0e1a13] text-base font-medium leading-normal">Varoinmarwah</h1>
          <div class="flex flex-col gap-2">
            <a class="sidebar-item nav-item" data-page="dashboard">
              <div class="text-[#0e1a13]" data-icon="House" data-size="24px" data-weight="fill">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path>
                </svg>
              </div>
              <p class="text-[#0e1a13] text-sm font-medium leading-normal">Dashboard</p>
            </a>
            <a class="sidebar-item nav-item" data-page="orders">
              <div class="text-[#0e1a13]" data-icon="Package" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32l80.34,44-29.77,16.3-80.35-44ZM128,120,47.66,76l33.9-18.56,80.34,44ZM40,90l80,43.78v85.79L40,175.82Zm176,85.78h0l-80,43.79V133.82l32-17.51V152a8,8,0,0,0,16,0V107.55L216,90v85.77Z"></path>
                </svg>
              </div>
              <p class="text-[#0e1a13] text-sm font-medium leading-normal">Orders</p>
            </a>
            <a class="sidebar-item nav-item" data-page="customers">
              <div class="text-[#0e1a13]" data-icon="Users" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,1,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
                </svg>
              </div>
              <p class="text-[#0e1a13] text-sm font-medium leading-normal">Customers</p>
            </a>
            <a class="sidebar-item nav-item" data-page="createOrder">
              <div class="text-[#0e1a13]" data-icon="Plus" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
                </svg>
              </div>
              <p class="text-[#0e1a13] text-sm font-medium leading-normal">Create Order</p>
            </a>
            <a class="sidebar-item nav-item" data-page="settings">
              <div class="text-[#0e1a13]" data-icon="Gear" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"></path>
                </svg>
              </div>
              <p class="text-[#0e1a13] text-sm font-medium leading-normal">Settings</p>
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation Toggle -->
      <button id="mobileNavToggle" class="mobile-nav-toggle" title="Open mobile navigation">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
          <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path>
        </svg>
      </button>

      <!-- Mobile Navigation Menu -->
      <div id="mobileNavMenu" class="mobile-nav-menu">
        <button id="closeMobileNav" style="position: absolute; top: 1rem; right: 1rem; color: white; background: none; border: none; font-size: 2rem;">&times;</button>
        <a class="mobile-nav-item nav-item" data-page="dashboard">Dashboard</a>
        <a class="mobile-nav-item nav-item" data-page="orders">Orders</a>
        <a class="mobile-nav-item nav-item" data-page="customers">Customers</a>
        <a class="mobile-nav-item nav-item" data-page="createOrder">Create Order</a>
        <a class="mobile-nav-item nav-item" data-page="settings">Settings</a>
        <button id="mobileLogoutBtn" class="mobile-nav-item" style="background: rgba(220, 38, 38, 0.8);">Logout</button>
      </div>

      <!-- Main Content Container -->
      <div class="flex flex-col flex-1 min-h-0">
        <!-- Header -->
        <header class="header flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#d1e6d9] px-4 py-3 bg-[#f8fbfa]">
          <div class="flex items-center gap-4">
            <h2 class="text-[#0e1a13] text-lg font-bold leading-tight tracking-[-0.015em]">Fashion Admin Dashboard</h2>
          </div>
          <div class="flex items-center gap-4">
            <button
              id="logoutBtn"
              class="flex cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#e8f2ec] text-[#0e1a13] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-4 hover:bg-[#d1e6d9]"
            >
              Logout
            </button>
            <div
              class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
              style='background-image: url("https://ui-avatars.com/api/?name=User&background=e8f2ec&color=0e1a13");'
            ></div>
          </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content flex flex-1 justify-center py-5 px-4">
          <div class="layout-content-container flex flex-col max-w-[1200px] flex-1">          <!-- Dashboard Page -->
          <section id="dashboardPage" class="page-section">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#0e1a13] tracking-light text-[32px] font-bold leading-tight min-w-72">Dashboard</p>
            </div>            <div class="flex flex-wrap gap-4 p-4">
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#d1e6d9] bg-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Total Orders</p>
                <p id="totalOrders" class="text-[#0e1a13] tracking-light text-2xl font-bold leading-tight">0</p>
              </div>
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#d1e6d9] bg-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Pending Orders</p>
                <p id="pendingOrders" class="text-[#ca8a04] tracking-light text-2xl font-bold leading-tight">0</p>
              </div>
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#d1e6d9] bg-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Completed Orders</p>
                <p id="completedOrders" class="text-[#51946b] tracking-light text-2xl font-bold leading-tight">0</p>
              </div>
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#d1e6d9] bg-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Active Customers</p>
                <p id="totalCustomers" class="text-[#0e1a13] tracking-light text-2xl font-bold leading-tight">0</p>
              </div>
              <!-- New Status Cards -->
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#f59e0b] bg-gradient-to-br from-[#fffbeb] to-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Trials Coming Up</p>
                <p id="trialsComingUp" class="text-[#f59e0b] tracking-light text-2xl font-bold leading-tight">0</p>
                <p class="text-[#f59e0b] text-xs font-medium">Next 7 days</p>
              </div>
              <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 border border-[#10b981] bg-gradient-to-br from-[#ecfdf5] to-white">
                <p class="text-[#0e1a13] text-base font-medium leading-normal">Deliveries Coming Up</p>
                <p id="deliveriesComingUp" class="text-[#10b981] tracking-light text-2xl font-bold leading-tight">0</p>
                <p class="text-[#10b981] text-xs font-medium">Next 7 days</p>
              </div>
            </div>
            <h2 class="text-[#0e1a13] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">Recent Orders</h2>
            <div class="px-4 py-3">
              <div class="overflow-hidden rounded-xl border border-[#d1e6d9] bg-[#f8fbfa]">
                <table class="w-full">
                  <thead class="bg-[#f8fbfa]">
                    <tr class="border-b border-[#d1e6d9]">
                      <th class="px-4 py-3 text-left text-[#0e1a13] text-sm font-medium">Order ID</th>
                      <th class="px-4 py-3 text-left text-[#0e1a13] text-sm font-medium">Customer</th>
                      <th class="px-4 py-3 text-left text-[#0e1a13] text-sm font-medium">Status</th>
                      <th class="px-4 py-3 text-left text-[#0e1a13] text-sm font-medium">Date</th>
                    </tr>
                  </thead>
                  <tbody id="recentOrdersTable">
                    <tr>
                      <td colspan="4" class="px-4 py-8 text-center text-[#51946b]">No recent orders</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>          <!-- Orders Page -->
          <section id="ordersPage" class="page-section" style="display:none;">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#111518] tracking-light text-[32px] font-bold leading-tight min-w-72">Orders</p>
              <button id="createOrderNavBtnFromOrdersPage" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#51946b] text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#3d7354]">
                + Create Order
              </button>
            </div>
            <div class="px-4 py-3">
              <div class="overflow-hidden rounded-lg border border-[#d1e6d9]">
                <table class="w-full">
                  <thead class="bg-[#f8fafc]">
                    <tr class="border-b border-[#d1e6d9]">                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">ORDER ID</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">CUSTOMER</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">TYPE</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">STATUS</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">TECHPACK</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">DELIVERY DATE</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">ATTACHMENTS</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                    <tr>
                      <td colspan="7" class="px-4 py-8 text-center text-[#6a7681]">No orders found</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- Order Preview Panel -->
            <div id="orderPreviewPanel" class="order-details-form" style="display:none;">
  <form id="orderDetailsForm">
    <label>Order ID</label>
    <input type="text" id="orderIdField" disabled value="" />
    <label>Customer Name</label>
    <input type="text" id="customerNameField" disabled value="" />
    <label>Status</label>
    <select id="orderStatusField" disabled>
      <option value="Pending">Pending</option>
      <option value="Completed">Completed</option>
      <option value="Cancelled">Cancelled</option>
    </select>
    <label>Date</label>
    <input type="date" id="orderDateField" disabled value="" />
    <div class="order-details-actions">
      <button type="button" class="order-btn edit" id="editOrderBtn">Edit</button>
      <button type="button" class="order-btn delete" id="deleteOrderBtn">Delete</button>
      <button type="submit" class="order-btn save" id="saveOrderBtn" style="display:none;">Save</button>
      <button type="button" class="order-btn cancel" id="cancelEditBtn" style="display:none;">Cancel</button>
    </div>
  </form>
</div>
          </section>          <!-- Create Order Page -->
          <section id="createOrderPage" class="page-section" style="display:none;">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#111518] tracking-light text-[32px] font-bold leading-tight min-w-72">Create New Order</p>
            </div>            <form id="createOrderForm" class="p-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Customer Name</label>
                  <input type="text" name="customerName" required class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter full customer name">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Phone</label>
                  <input type="tel" name="phone" required class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter phone number">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Dress Category</label>
                  <input type="text" name="category" required class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter dress category (e.g., Bridal Gown, Evening Dress)">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Dress Type</label>
                  <input type="text" name="type" required class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter dress type (e.g., Custom, Standard, Alteration)">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Fabric Name</label>
                  <input type="text" name="fabricName" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter fabric name/type">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Style Reference</label>
                  <input type="text" name="styleReference" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter style reference (e.g., Modern, Classic, Bohemian)">
                </div>
              </div>
              
              <!-- Fabric Attachment Section -->
              <div class="mb-6">
                <label class="block text-[#111518] text-sm font-medium mb-2">Fabric Attachment</label>
                <div class="border-2 border-dashed border-[#d1e6d9] rounded-lg p-6 text-center hover:border-[#51946b] transition-colors">
                  <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-[#6a7681]" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="text-[#111518] font-medium">Upload Fabric Images or Documents</p>
                    <p class="text-[#6a7681] text-sm">Drag and drop files here or click to browse</p>
                  </div>
                  <input type="file" name="fabricAttachment" id="fabricAttachment" accept="image/*,.pdf" class="hidden">
                  <button type="button" onclick="document.getElementById('fabricAttachment').click()" class="px-4 py-2 bg-[#51946b] text-white rounded-lg hover:bg-[#3d7354] transition-colors">
                    üìé Upload Fabric
                  </button>
                  <div id="fabricPreview" class="mt-3 text-sm text-[#6a7681] hidden"></div>
                </div>
              </div>
              
              <!-- Style Attachment Section -->
              <div class="mb-6">
                <label class="block text-[#111518] text-sm font-medium mb-2">Style Attachment</label>
                <div class="border-2 border-dashed border-[#d1e6d9] rounded-lg p-6 text-center hover:border-[#51946b] transition-colors">
                  <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-[#6a7681]" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="text-[#111518] font-medium">Upload Style Reference Images</p>
                    <p class="text-[#6a7681] text-sm">Drag and drop style references here or click to browse</p>
                  </div>
                  <input type="file" name="styleAttachment" id="styleAttachment" accept="image/*,.pdf" class="hidden">
                  <button type="button" onclick="document.getElementById('styleAttachment').click()" class="px-4 py-2 bg-[#51946b] text-white rounded-lg hover:bg-[#3d7354] transition-colors">
                    üìé Upload Style
                  </button>
                  <div id="stylePreview" class="mt-3 text-sm text-[#6a7681] hidden"></div>
                </div>
              </div>              <div class="mb-6">
                <label class="block text-[#111518] text-sm font-medium mb-2">Description</label>
                <textarea name="description" rows="4" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="Enter order description"></textarea>
              </div>
              
              <!-- Trial Date and Delivery Date Side by Side -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Trial Date</label>
                  <input type="date" name="trialDate" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent">
                </div>
                <div>
                  <label class="block text-[#111518] text-sm font-medium mb-2">Delivery Date</label>
                  <input type="date" name="deliveryDate" required class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent">
                </div>
              </div>
              <div class="mb-6">
                <h3 class="text-[#111518] text-lg font-bold mb-4">Measurements</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <label class="block text-[#111518] text-sm font-medium mb-2">Chest (inches)</label>
                    <input type="number" name="chest" step="0.5" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="0.0">
                  </div>
                  <div>
                    <label class="block text-[#111518] text-sm font-medium mb-2">Waist (inches)</label>
                    <input type="number" name="waist" step="0.5" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="0.0">
                  </div>
                  <div>
                    <label class="block text-[#111518] text-sm font-medium mb-2">Hip (inches)</label>
                    <input type="number" name="hip" step="0.5" class="w-full px-3 py-2 border border-[#d1e6d9] rounded-lg focus:ring-2 focus:ring-[#51946b] focus:border-transparent" placeholder="0.0">
                  </div>
                </div>
              </div>              <!-- Enhanced Additional Attachments Section -->
              <div class="mb-6">
                <label class="block text-[#111518] text-sm font-medium mb-2">Additional Attachments</label>
                <div class="border-2 border-dashed border-[#d1e6d9] rounded-lg p-6 text-center hover:border-[#51946b] transition-colors" id="additionalAttachmentsZone">
                  <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-[#6a7681]" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="text-[#111518] font-medium">Upload Additional Files</p>
                    <p class="text-[#6a7681] text-sm">Drag and drop files here or click to browse</p>
                    <p class="text-xs text-[#6a7681] mt-2">Supports: Images, PDFs, Documents (Max 10MB each)</p>
                  </div>
                  <input type="file" name="attachments" id="orderAttachments" multiple accept="image/*,.pdf,.doc,.docx,.txt,.xlsx,.ppt,.pptx" class="hidden">
                  <div class="flex flex-col sm:flex-row gap-2 justify-center">
                    <button type="button" id="selectFilesBtn" class="px-4 py-2 bg-[#51946b] text-white rounded-lg hover:bg-[#3d7354] transition-colors">
                      üìé Select Files
                    </button>
                    <button type="button" id="addMoreFilesBtn" class="px-4 py-2 bg-[#28a745] text-white rounded-lg hover:bg-[#218838] transition-colors hidden">
                      ‚ûï Add More
                    </button>
                    <button type="button" id="clearAllFilesBtn" class="px-4 py-2 bg-[#dc3545] text-white rounded-lg hover:bg-[#c82333] transition-colors hidden">
                      üóëÔ∏è Clear All
                    </button>
                  </div>
                </div>
                
                <!-- Selected Files Display -->
                <div id="selectedFilesDisplay" class="mt-4 hidden">
                  <div class="bg-[#f8fafc] border border-[#d1e6d9] rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="text-[#111518] text-sm font-medium">Selected Files (<span id="fileCount">0</span>)</h4>
                      <span class="text-xs text-[#6a7681]">Click files to preview</span>
                    </div>
                    <div id="filesList" class="space-y-2 max-h-48 overflow-y-auto">
                      <!-- Files will be displayed here -->
                    </div>
                  </div>
                </div>
              </div>
              <button type="submit" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-6 bg-[#51946b] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#3d7354]">
                Create Order
              </button>
            </form>
          </section>          <!-- Customers Page -->
          <section id="customersPage" class="page-section" style="display:none;">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#111518] tracking-light text-[32px] font-bold leading-tight min-w-72">Customers</p>
            </div>
            <div class="px-4 py-3">
              <div class="overflow-hidden rounded-lg border border-[#d1e6d9]">
                <table class="w-full">
                  <thead class="bg-[#f8fafc]">                    <tr class="border-b border-[#d1e6d9]">
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">NAME</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">PHONE</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">ORDERS</th>
                      <th class="px-4 py-3 text-left text-[#111518] text-sm font-medium">ACTION</th>
                    </tr>
                  </thead>
                  <tbody id="customersTableBody">
                    <tr>
                      <td colspan="4" class="px-4 py-8 text-center text-[#6a7681]">No customers found</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
          
          <!-- Settings Page -->
          <section id="settingsPage" class="page-section" style="display:none;">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p class="text-[#111518] tracking-light text-[32px] font-bold leading-tight min-w-72">Settings</p>
            </div>
            <div class="p-4">
              <p class="text-[#6a7681] text-base">Settings will be available soon.</p>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Tab navigation for sidebar and mobile nav
    document.addEventListener('DOMContentLoaded', function () {
      const pages = {
        dashboard: document.getElementById('dashboardPage'),
        orders: document.getElementById('ordersPage'),
        customers: document.getElementById('customersPage'),
        createOrder: document.getElementById('createOrderPage'),
        settings: document.getElementById('settingsPage'),
      };
      function showPage(page) {
        Object.keys(pages).forEach(key => {
          if (pages[key]) pages[key].style.display = (key === page) ? '' : 'none';
        });
      }
      // Sidebar navigation
      document.querySelectorAll('.sidebar-item.nav-item').forEach(item => {
        item.addEventListener('click', function () {
          const page = this.getAttribute('data-page');
          showPage(page);
        });
      });
      // Mobile navigation
      document.querySelectorAll('.mobile-nav-item.nav-item').forEach(item => {
        item.addEventListener('click', function () {
          const page = this.getAttribute('data-page');
          showPage(page);
          document.getElementById('mobileNavMenu').style.display = 'none';
        });
      });
      // Mobile nav toggle open/close
      const mobileNavToggle = document.getElementById('mobileNavToggle');
      const mobileNavMenu = document.getElementById('mobileNavMenu');
      const closeMobileNav = document.getElementById('closeMobileNav');
      if (mobileNavToggle && mobileNavMenu) {
        mobileNavToggle.addEventListener('click', function () {
          mobileNavMenu.style.display = 'block';
        });
      }
      if (closeMobileNav && mobileNavMenu) {
        closeMobileNav.addEventListener('click', function () {
          mobileNavMenu.style.display = 'none';
        });
      }
      // Optionally, show dashboard by default
      showPage('dashboard');
    });
  </script>
  <script>
    // --- Data Models with Persistence ---
function saveData() {
  localStorage.setItem('orders', JSON.stringify(orders));
  localStorage.setItem('customers', JSON.stringify(customers));
}
function loadData() {
  const o = localStorage.getItem('orders');
  const c = localStorage.getItem('customers');  orders = o ? JSON.parse(o) : [
    {
      id: 1,
      customer: 'Sarah Johnson',
      category: 'Bridal Gown',
      type: 'Custom',
      description: 'Elegant off-shoulder bridal gown with lace details',
      status: 'In Progress',
      trialDate: '2025-06-15',
      deliveryDate: '2024-07-15',
      measurements: { chest: 34, waist: 26, hip: 36 },
      attachments: [
        { id: 'sample1', name: 'design_sketch.jpg', url: '#', size: 245760, type: 'image/jpeg' }
      ]
    },    {
      id: 2,
      customer: 'Emily Davis',
      category: 'Evening Dress',
      type: 'Standard',
      description: 'Black evening dress for gala event',
      status: 'Completed',
      trialDate: '2025-06-10',
      deliveryDate: '2024-06-30',
      measurements: { chest: 32, waist: 24, hip: 34 },
      attachments: []
    },
    {
      id: 3,
      customer: 'Maria Rodriguez',
      category: 'Cocktail Dress',
      type: 'Custom',      description: 'Red cocktail dress with sequin details',
      status: 'In Progress',
      trialDate: '2025-06-16',
      deliveryDate: '2024-08-01',
      measurements: { chest: 36, waist: 28, hip: 38 },
      attachments: [
        { id: 'sample2', name: 'reference_image.png', url: '#', size: 184320, type: 'image/png' }
      ]
    }
  ];
  customers = c ? JSON.parse(c) : [
    {
      name: 'Sarah Johnson',
      email: 'sarah.johnson@email.com',
      phone: '(555) 123-4567',
      orders: 1
    },
    {
      name: 'Emily Davis',
      email: 'emily.davis@email.com',
      phone: '(555) 234-5678',
      orders: 1
    },
    {
      name: 'Maria Rodriguez',
      email: 'maria.rodriguez@email.com',
      phone: '(555) 345-6789',
      orders: 1
    }
  ];
}

// --- Dashboard Rendering ---
function renderDashboard() {
  const today = new Date();
  const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
  
  // Calculate upcoming trials and deliveries (within next 7 days)
  const upcomingTrials = orders.filter(order => {
    if (!order.trialDate) return false;
    const trialDate = new Date(order.trialDate);
    return trialDate >= today && trialDate <= nextWeek && order.status !== 'Completed' && order.status !== 'Cancelled';
  }).length;
  
  const upcomingDeliveries = orders.filter(order => {
    if (!order.deliveryDate) return false;
    const deliveryDate = new Date(order.deliveryDate);
    return deliveryDate >= today && deliveryDate <= nextWeek && order.status !== 'Completed' && order.status !== 'Cancelled';
  }).length;
  
  document.getElementById('totalOrders').textContent = orders.length;
  document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'In Progress').length;
  document.getElementById('completedOrders').textContent = orders.filter(o => o.status === 'Completed').length;
  document.getElementById('totalCustomers').textContent = customers.length;
  
  // Update new status elements
  if (document.getElementById('trialsComingUp')) {
    document.getElementById('trialsComingUp').textContent = upcomingTrials;
  }
  if (document.getElementById('deliveriesComingUp')) {
    document.getElementById('deliveriesComingUp').textContent = upcomingDeliveries;
  }
  document.getElementById('totalCustomers').textContent = customers.length;
}

// --- Orders Table Rendering ---
function renderOrders() {
  const tbody = document.getElementById('ordersTableBody');
  const recentOrdersTable = document.getElementById('recentOrdersTable');
  
  // Clear both tables
  tbody.innerHTML = '';
  if (recentOrdersTable) recentOrdersTable.innerHTML = '';
  
  if (orders.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#6a7681]">No orders found</td></tr>';
    if (recentOrdersTable) {
      recentOrdersTable.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-[#6a7681]">No recent orders</td></tr>';
    }
    return;
  }
        <button onclick="previewFile(event, '${order.techpackAttachment.url}', '${order.techpackAttachment.name}', '${order.techpackAttachment.type}')" 
                class="text-[#51946b] hover:text-[#3d7354] text-sm font-medium flex items-center gap-1" 
                title="Preview ${order.techpackAttachment.name}">
          üìé ${order.techpackAttachment.name.substring(0, 12)}${order.techpackAttachment.name.length > 12 ? '...' : ''}
        </button>
      </div>` : 
      `<div class="techpack-cell flex items-center gap-2">
        <input type="file" id="techpack-${order.id}" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" 
               onchange="uploadTechpack(${order.id}, this)" class="hidden">
        <button onclick="document.getElementById('techpack-${order.id}').click()" 
                class="bg-[#51946b] hover:bg-[#3d7354] text-white px-2 py-1 rounded text-xs font-medium">
          + TechPack
        </button>
      </div>`;
    
    tr.innerHTML = `
      <td class="px-4 py-3 text-[#111518] text-sm">#${order.id}</td>
      <td class="px-4 py-3 text-[#111518] text-sm">${order.customer}</td>
      <td class="px-4 py-3 text-[#111518] text-sm">${order.category || order.type || ''}</td>
      <td class="px-4 py-3"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">${order.status}</span></td>
      <td class="px-4 py-3">${techpackHtml}</td>
      <td class="px-4 py-3 text-[#111518] text-sm">${order.deliveryDate || ''}</td>
      <td class="px-4 py-3 text-[#111518] text-sm">üìé ${attachmentCount}</td>
    `;
    tr.onclick = () => displayOrderPreview(order.id);
    tbody.appendChild(tr);
  });
  
  // Render recent orders for dashboard (last 5)
  if (recentOrdersTable) {
    const recentOrders = orders.slice(-5).reverse();
    recentOrders.forEach(order => {
      const tr = document.createElement('tr');
      tr.className = 'border-b border-[#d1e6d9] hover:bg-[#f8fafc]';
      
      const statusColor = order.status === 'Completed' ? 'text-[#10b981] bg-[#ecfdf5]' : 'text-[#f59e0b] bg-[#fffbeb]';
      
    tr.onclick = () => displayOrderPreview(order.id);
    tbody.appendChild(tr);
  });
  
  // Render recent orders for dashboard (last 5)
  if (recentOrdersTable) {
    const recentOrders = orders.slice(-5).reverse();
    recentOrders.forEach(order => {
      const tr = document.createElement('tr');
      tr.className = 'border-b border-[#d1e6d9] hover:bg-[#f8fafc]';
      
      const statusColor = order.status === 'Completed' ? 'text-[#10b981] bg-[#ecfdf5]' : 'text-[#f59e0b] bg-[#fffbeb]';
      
      tr.innerHTML = `
        <td class="px-4 py-3 text-[#111518] text-sm">#${order.id}</td>
        <td class="px-4 py-3 text-[#111518] text-sm">${order.customer}</td>
        <td class="px-4 py-3"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">${order.status}</span></td>
        <td class="px-4 py-3 text-[#111518] text-sm">${order.deliveryDate || ''}</td>
      `;
      recentOrdersTable.appendChild(tr);
    });
  }
}

// --- Order Preview Rendering ---
function displayOrderPreview(orderId) {
  const order = orders.find(o => o.id === orderId);
  const previewPanel = document.getElementById('orderPreviewPanel');
  const detailsContent = document.getElementById('orderDetailsContent');
  const previewOrderTitle = document.getElementById('previewOrderTitle');

  if (!order) {
    detailsContent.innerHTML = '<p>Order not found.</p>';
    previewPanel.style.display = 'block'; // Show panel even if order not found
    return;
  }
  previewOrderTitle.textContent = `Details for Order #${order.id}`;
  
  // Handle fabric attachment
  let fabricAttachmentHtml = '';
  if (order.fabricAttachment) {
    const icon = order.fabricAttachment.type && order.fabricAttachment.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ';
    fabricAttachmentHtml = `<p><strong>Fabric Attachment:</strong> ${icon} <a href="${order.fabricAttachment.url}" target="_blank" title="View file: ${order.fabricAttachment.name}">${order.fabricAttachment.name}</a> (${(order.fabricAttachment.size / 1024).toFixed(1)} KB)</p>`;
  }
    // Handle style attachment
  let styleAttachmentHtml = '';
  if (order.styleAttachment) {
    const icon = order.styleAttachment.type && order.styleAttachment.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ';
    styleAttachmentHtml = `<p><strong>Style Attachment:</strong> ${icon} <a href="${order.styleAttachment.url}" target="_blank" title="View file: ${order.styleAttachment.name}">${order.styleAttachment.name}</a> (${(order.styleAttachment.size / 1024).toFixed(1)} KB)</p>`;
  }
  
  // Handle techpack attachment
  let techpackAttachmentHtml = '';
  if (order.techpackAttachment) {
    const icon = order.techpackAttachment.type && order.techpackAttachment.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ';
    techpackAttachmentHtml = `<p><strong>TechPack Attachment:</strong> ${icon} <a href="${order.techpackAttachment.url}" target="_blank" title="View file: ${order.techpackAttachment.name}">${order.techpackAttachment.name}</a> (${(order.techpackAttachment.size / 1024).toFixed(1)} KB)</p>`;
  }
  
  let attachmentsHtml = '<h4>Additional Attachments:</h4>';
  if (order.attachments && order.attachments.length > 0) {
    attachmentsHtml += '<ul class="attachment-list">';
    order.attachments.forEach(att => {
      const icon = att.type && att.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ';
      // Displaying actual thumbnails from Google Drive requires more complex handling (e.g., thumbnailLink)
      // For now, we show an icon and the name.
      attachmentsHtml += `<li>${icon} <a href="${att.url}" target="_blank" title="View file: ${att.name}">${att.name}</a> (${(att.size / 1024).toFixed(1)} KB)</li>`;
    });
    attachmentsHtml += '</ul>';
  } else {
    attachmentsHtml += '<p>No additional attachments.</p>';
  }
  detailsContent.innerHTML = `
    <p><strong>Customer:</strong> ${order.customer}</p>
    <p><strong>Category:</strong> ${order.category || 'N/A'}</p>
    <p><strong>Type:</strong> ${order.type || 'N/A'}</p>
    <p><strong>Fabric Name:</strong> ${order.fabricName || 'N/A'}</p>
    <p><strong>Style Reference:</strong> ${order.styleReference || 'N/A'}</p>
    <p><strong>Description:</strong> ${order.description || 'N/A'}</p>
    <p><strong>Status:</strong> ${order.status}</p>    <p><strong>Trial Date:</strong> ${order.trialDate || 'N/A'}</p>
    <p><strong>Delivery Date:</strong> ${order.deliveryDate}</p>
    ${fabricAttachmentHtml}
    ${styleAttachmentHtml}
    ${techpackAttachmentHtml}
    ${attachmentsHtml}
  `;
  previewPanel.style.display = 'block';
}

// --- Customers Table Rendering & Editing ---
function renderCustomers() {
  const tbody = document.getElementById('customersTableBody');
  tbody.innerHTML = '';  if (customers.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-[#6a7681]">No customers found</td></tr>';
    return;
  }
  customers.forEach((customer, idx) => {
    const tr = document.createElement('tr');
    tr.className = 'border-b border-[#d1e6d9] hover:bg-[#f8fafc]';
    tr.innerHTML = `
      <td class="px-4 py-3 text-[#111518] text-sm"><span class="customer-name">${customer.name}</span></td>
      <td class="px-4 py-3 text-[#111518] text-sm"><span class="customer-phone">${customer.phone}</span></td>
      <td class="px-4 py-3 text-[#111518] text-sm">${customer.orders}</td>
      <td class="px-4 py-3"><button class="edit-btn px-3 py-1 bg-[#51946b] text-white rounded-lg text-sm hover:bg-[#3d7354]" data-idx="${idx}">Edit</button></td>
    `;
    tbody.appendChild(tr);
  });
  // Add edit listeners
  tbody.querySelectorAll('.edit-btn').forEach(btn => {
    btn.onclick = function() {
      const idx = +btn.dataset.idx;
      editCustomerRow(idx);
    };
  });
}
function editCustomerRow(idx) {
  const tbody = document.getElementById('customersTableBody');
  const tr = tbody.children[idx];
  const customer = customers[idx];  tr.innerHTML = `
    <td class="px-4 py-3"><input value="${customer.name}" class="w-full px-2 py-1 border border-[#d1e6d9] rounded text-sm" id="editName${idx}"></td>
    <td class="px-4 py-3"><input value="${customer.phone}" class="w-full px-2 py-1 border border-[#d1e6d9] rounded text-sm" id="editPhone${idx}"></td>
    <td class="px-4 py-3 text-[#111518] text-sm">${customer.orders}</td>
    <td class="px-4 py-3"><button class="save-btn px-3 py-1 bg-[#10b981] text-white rounded-lg text-sm hover:bg-[#059669]" data-idx="${idx}">Save</button></td>
  `;
  tr.querySelector('.save-btn').onclick = function() {
    customers[idx].name = document.getElementById(`editName${idx}`).value;
    customers[idx].phone = document.getElementById(`editPhone${idx}`).value;
    saveData();
    renderCustomers();
  };
}

// --- Create Order Form Logic ---
document.getElementById('createOrderForm').onsubmit = async function(e) {
  e.preventDefault();
  const form = e.target;

  // Indicate loading/processing if desired
  // e.g., disable submit button, show spinner
  // Handle file uploads
  let uploadedFileDetails = [];
  let fabricFileDetails = null;
  let styleFileDetails = null;
  
  // Upload fabric attachment if present
  const fabricFile = form.fabricAttachment.files[0];
  if (fabricFile && cloudStorage) {
    try {
      console.log(`Uploading fabric file: ${fabricFile.name}`);
      const uploadedFabric = await cloudStorage.uploadFile(fabricFile, fabricFile.name);
      fabricFileDetails = {
        id: uploadedFabric.fileId,
        name: uploadedFabric.name,
        url: uploadedFabric.url,
        size: uploadedFabric.size,
        type: uploadedFabric.type
      };
      console.log(`Successfully uploaded fabric: ${fabricFile.name}`);
    } catch (error) {
      console.error(`Failed to upload fabric: ${fabricFile.name}:`, error);
      alert(`Error uploading fabric: ${error.message}`);
    }
  }
  
  // Upload style attachment if present
  const styleFile = form.styleAttachment.files[0];
  if (styleFile && cloudStorage) {
    try {
      console.log(`Uploading style file: ${styleFile.name}`);
      const uploadedStyle = await cloudStorage.uploadFile(styleFile, styleFile.name);
      styleFileDetails = {
        id: uploadedStyle.fileId,
        name: uploadedStyle.name,
        url: uploadedStyle.url,
        size: uploadedStyle.size,
        type: uploadedStyle.type
      };
      console.log(`Successfully uploaded style: ${styleFile.name}`);
    } catch (error) {
      console.error(`Failed to upload style: ${styleFile.name}:`, error);
      alert(`Error uploading style: ${error.message}`);
    }
  }

  // Upload additional attachments if present
  const filesToUpload = form.attachments?.files || [];
  if (filesToUpload.length > 0 && cloudStorage) {
    console.log(`Attempting to upload ${filesToUpload.length} additional files...`);
    for (let i = 0; i < filesToUpload.length; i++) {
      const file = filesToUpload[i];
      try {
        const onProgress = (percentage) => console.log(`Uploading ${file.name}: ${percentage.toFixed(2)}%`);
        const uploadedFile = await cloudStorage.uploadFile(file, file.name, onProgress);
        uploadedFileDetails.push({
          id: uploadedFile.fileId,
          name: uploadedFile.name,
          url: uploadedFile.url,
          size: uploadedFile.size,
          type: uploadedFile.type
        });
        console.log(`Successfully uploaded ${file.name}`, uploadedFile);
      } catch (error) {
        console.error(`Failed to upload ${file.name}:`, error);
        alert(`Error uploading ${file.name}: ${error.message}. Order creation may be incomplete.`);
        return;
      }
    }
  }

  const newOrder = {
    id: orders.length > 0 ? Math.max(0, ...orders.map(o => o.id)) + 1 : 1,
    customer: form.customerName.value,
    category: form.category.value,
    type: form.type.value,
    fabricName: form.fabricName.value,
    styleReference: form.styleReference.value,
    description: form.description.value,
    status: 'In Progress',
    trialDate: form.trialDate.value,
    deliveryDate: form.deliveryDate.value,
    measurements: { 
      chest: form.chest.value, 
      waist: form.waist.value, 
      hip: form.hip.value 
    },
    attachments: uploadedFileDetails,
    fabricAttachment: fabricFileDetails,
    styleAttachment: styleFileDetails
  };
  orders.push(newOrder);  // Add customer if not exists
  let custIdx = customers.findIndex(c => c.phone === form.phone.value);
  if (custIdx === -1) {
    customers.push({
      name: newOrder.customer,
      phone: form.phone.value,
      orders: 1
    });} else {
    customers[custIdx].orders++;
  }
  saveData();
  renderOrders();
  renderDashboard();
  renderCustomers();
    // Switch to Orders page
  navItems.forEach(i => {
    i.classList.remove('text-[#51946b]', 'font-bold');
  });
  const ordersNavItem = Array.from(navItems).find(item => item.dataset.page === 'orders');
  if (ordersNavItem) {
    ordersNavItem.classList.add('text-[#51946b]', 'font-bold');
  }
  Object.values(pageSections).forEach(sec => sec.style.display = 'none');
  if (pageSections.orders) {
    pageSections.orders.style.display = '';
  }
  form.reset();
};    // --- File Preview Handlers ---
// Handle fabric attachment file preview
document.getElementById('fabricAttachment').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const preview = document.getElementById('fabricPreview');
  
  if (file) {
    preview.innerHTML = `
      <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg cursor-pointer" onclick="previewSingleFile(this, 'fabric')">
        <div class="flex items-center gap-2">
          <span class="text-lg">${file.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ'}</span>
          <span class="text-sm font-medium">${file.name}</span>
          <span class="text-xs text-gray-500">(${(file.size / 1024).toFixed(1)} KB)</span>
        </div>
        <span class="text-xs text-blue-600">Click to preview</span>
      </div>
    `;
    preview.classList.remove('hidden');
  } else {
    preview.classList.add('hidden');
  }
});

// Handle style attachment file preview
document.getElementById('styleAttachment').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const preview = document.getElementById('stylePreview');
  
  if (file) {
    preview.innerHTML = `
      <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg cursor-pointer" onclick="previewSingleFile(this, 'style')">
        <div class="flex items-center gap-2">
          <span class="text-lg">${file.type.startsWith('image/') ? 'üñºÔ∏è' : 'üìÑ'}</span>
          <span class="text-sm font-medium">${file.name}</span>
          <span class="text-xs text-gray-500">(${(file.size / 1024).toFixed(1)} KB)</span>
        </div>
        <span class="text-xs text-blue-600">Click to preview</span>
      </div>
    `;
    preview.classList.remove('hidden');
  } else {
    preview.classList.add('hidden');
  }
});

// Function to preview single files (fabric/style)
window.previewSingleFile = function(element, type) {
  const fileInput = type === 'fabric' ? 
    document.getElementById('fabricAttachment') : 
    document.getElementById('styleAttachment');
  
  const file = fileInput.files[0];
  if (file) {
    currentPreviewFile = file;
    showFilePreview(file);
  }
};

// ...existing code...

    // --- Page switching logic ---
    const loginPage = document.getElementById('loginPage');
    const appContainer = document.getElementById('appContainer');
    const loginBtn = document.getElementById('loginBtn');
    const loginStatus = document.getElementById('loginStatus');
    const navItems = document.querySelectorAll('.nav-item');
    const pageSections = {
      dashboard: document.getElementById('dashboardPage'),
      orders: document.getElementById('ordersPage'),
      createOrder: document.getElementById('createOrderPage'),
      customers: document.getElementById('customersPage'),
      settings: document.getElementById('settingsPage')
    };

    // Update navigation to work with new header design
    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        navItems.forEach(i => i.classList.remove('text-[#51946b]', 'font-bold'));
        item.classList.add('text-[#51946b]', 'font-bold');
        Object.values(pageSections).forEach(sec => sec.style.display = 'none');
        const targetPage = item.dataset.page;
        if (pageSections[targetPage]) {
          pageSections[targetPage].style.display = '';
        }
      });
    });

    // Add logout functionality
    document.addEventListener('DOMContentLoaded', () => {
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
          cloudStorage.logout();
          loginPage.style.display = 'block';
          appContainer.style.display = 'none';
        });
      }
    });

    function navigateToCreateOrder() {
      navItems.forEach(i => {
        i.classList.remove('text-[#51946b]', 'font-bold');
      });
      const createOrderNavItem = Array.from(navItems).find(item => item.dataset.page === 'createOrder');
      if (createOrderNavItem) {
        createOrderNavItem.classList.add('text-[#51946b]', 'font-bold');
      }
      Object.values(pageSections).forEach(sec => sec.style.display = 'none');
      pageSections.createOrder.style.display = '';
    }
    document.getElementById('createOrderNavBtnFromOrdersPage').onclick = navigateToCreateOrder;
    document.querySelector('.nav-item[data-page="createOrder"]').addEventListener('click', navigateToCreateOrder);

    // Helper function to show app and navigate to dashboard
    async function showAppAndDashboard() {
      try {
        console.log('Showing app and dashboard...');
        
        // Hide login page, show app container
        loginPage.style.display = 'none';
        appContainer.style.display = 'flex';
        
        console.log('App container shown, setting dashboard as active page...');

        // Explicitly set dashboard as active page
        navItems.forEach(i => {
          i.classList.remove('text-[#51946b]', 'font-bold');
        });
        
        const dashboardNavItem = Array.from(navItems).find(item => item.dataset.page === 'dashboard');
        if (dashboardNavItem) {
          dashboardNavItem.classList.add('text-[#51946b]', 'font-bold');
          console.log('Dashboard nav item activated');
        }

        // Hide all page sections and show dashboard
        Object.values(pageSections).forEach(sec => {
          if (sec) sec.style.display = 'none';
        });
        
        if (pageSections.dashboard) {
          pageSections.dashboard.style.display = '';
          console.log('Dashboard page shown');
        }

        // Load and render data
        console.log('Loading and rendering data...');
        loadData();
        renderDashboard();
        renderOrders();
        renderCustomers();
        console.log('App and dashboard shown successfully');
      } catch (error) {
        console.error('Error showing app and dashboard:', error);
      }
    }

    // Login logic
    async function handleLogin() {
      loginBtn.disabled = true;
      loginStatus.textContent = 'Signing in...';
      try {
        await cloudStorage.authenticate();
        await showAppAndDashboard();
      } catch (error) {
        loginStatus.textContent = 'Login failed: ' + error.message;
        loginStatus.style.color = '#ea4335';
      } finally {
        loginBtn.disabled = false;
      }
    }

    // Auto-login check on page load
    async function checkExistingAuth() {
      try {
        console.log('Checking for existing authentication...');
        await cloudStorage.initialize();
        
        if (cloudStorage.isAuthenticated()) {
          console.log('User already authenticated, redirecting to dashboard...');
          await showAppAndDashboard();
          return true;
        } else {
          console.log('User not authenticated, showing login page');
          loginPage.style.display = 'block';
          appContainer.style.display = 'none';
        }
      } catch (error) {
        console.warn('Auto-login check failed:', error);
      }
      return false;
    }

    // Add login button event listener
    document.getElementById('loginBtn').addEventListener('click', handleLogin);
    
    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        checkExistingAuth();
      }, 500);
    });
  </script>

  <!-- Custom File Preview Modal -->
  <div id="filePreviewModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <div class="flex-1 min-w-0">
          <h3 id="previewFileName" class="text-lg font-medium text-gray-900 truncate"></h3>
          <p id="previewFileInfo" class="text-sm text-gray-500"></p>
        </div>
        <div class="flex items-center gap-2 ml-4">
          <button id="previewDownloadBtn" class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
            üì• Download
          </button>
          <button id="closePreviewBtn" class="p-2 text-gray-400 hover:text-gray-600" title="Close preview">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Modal Content -->
      <div class="flex-1 overflow-auto p-4">
        <div id="previewContent" class="flex items-center justify-center min-h-full">
          <!-- Preview content will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced file attachment management for order creation
    let selectedFiles = [];
    let currentPreviewFile = null;

    document.addEventListener('DOMContentLoaded', function() {
      const selectFilesBtn = document.getElementById('selectFilesBtn');
      const addMoreFilesBtn = document.getElementById('addMoreFilesBtn');
      const clearAllFilesBtn = document.getElementById('clearAllFilesBtn');
      const orderAttachments = document.getElementById('orderAttachments');
      const selectedFilesDisplay = document.getElementById('selectedFilesDisplay');
      const filesList = document.getElementById('filesList');
      const fileCount = document.getElementById('fileCount');
      const additionalAttachmentsZone = document.getElementById('additionalAttachmentsZone');

      // Preview modal elements
      const previewModal = document.getElementById('filePreviewModal');
      const previewFileName = document.getElementById('previewFileName');
      const previewFileInfo = document.getElementById('previewFileInfo');
      const previewContent = document.getElementById('previewContent');
      const closePreviewBtn = document.getElementById('closePreviewBtn');
      const previewDownloadBtn = document.getElementById('previewDownloadBtn');

      // File selection handling
      function handleFileSelection(files) {
        const newFiles = Array.from(files).filter(file => {
          // Check file size (10MB limit)
          if (file.size > 10 * 1024 * 1024) {
            alert(`File "${file.name}" exceeds 10MB limit`);
            return false;
          }
          
          // Check for duplicates
          const exists = selectedFiles.some(f => f.name === file.name && f.size === file.size);
          if (exists) {
            return false;
          }
          
          return true;
        });

        selectedFiles = [...selectedFiles, ...newFiles];
        updateFileDisplay();
        updateFileInput();
      }

      function updateFileDisplay() {
        fileCount.textContent = selectedFiles.length;
        
        if (selectedFiles.length === 0) {
          selectedFilesDisplay.classList.add('hidden');
          addMoreFilesBtn.classList.add('hidden');
          clearAllFilesBtn.classList.add('hidden');
          return;
        }

        selectedFilesDisplay.classList.remove('hidden');
        addMoreFilesBtn.classList.remove('hidden');
        clearAllFilesBtn.classList.remove('hidden');

        filesList.innerHTML = selectedFiles.map((file, index) => {
          const fileIcon = getFileIcon(file.type);
          const fileSize = formatFileSize(file.size);
          
          return `
            <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:border-blue-500 cursor-pointer" onclick="previewFile(${index})">
              <div class="flex items-center gap-3 flex-1 min-w-0">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <span class="text-blue-600 text-lg">${fileIcon}</span>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 truncate">${file.name}</p>
                  <p class="text-xs text-gray-500">${fileSize} ‚Ä¢ ${getFileTypeLabel(file.type)}</p>
                </div>
              </div>
              <button onclick="removeFile(${index}); event.stopPropagation();" class="ml-2 p-1 text-red-500 hover:text-red-700" title="Remove file">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          `;
        }).join('');
      }

      function updateFileInput() {
        // Create a new DataTransfer object to update the file input
        const dt = new DataTransfer();
        selectedFiles.forEach(file => dt.items.add(file));
        orderAttachments.files = dt.files;
      }

      function getFileIcon(mimeType) {
        if (mimeType.startsWith('image/')) return 'üñºÔ∏è';
        if (mimeType.includes('pdf')) return 'üìÑ';
        if (mimeType.includes('word') || mimeType.includes('document')) return 'üìù';
        if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return 'üìä';
        if (mimeType.includes('powerpoint') || mimeType.includes('presentation')) return 'üìà';
        return 'üìé';
      }

      function getFileTypeLabel(mimeType) {
        if (mimeType.startsWith('image/')) return 'Image';
        if (mimeType.includes('pdf')) return 'PDF';
        if (mimeType.includes('word')) return 'Word Document';
        if (mimeType.includes('excel')) return 'Excel Spreadsheet';
        if (mimeType.includes('powerpoint')) return 'PowerPoint';
        return 'Document';
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
      }

      // Global functions for inline event handlers
      window.removeFile = function(index) {
        selectedFiles.splice(index, 1);
        updateFileDisplay();
        updateFileInput();
      };

      window.previewFile = function(index) {
        const file = selectedFiles[index];
        currentPreviewFile = file;
        showFilePreview(file);
      };

      function showFilePreview(file) {
        previewFileName.textContent = file.name;
        previewFileInfo.textContent = `${formatFileSize(file.size)} ‚Ä¢ ${getFileTypeLabel(file.type)}`;
        
        previewContent.innerHTML = '<div class="text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div><p class="mt-2 text-gray-500">Loading preview...</p></div>';
        
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewContent.innerHTML = `<img src="${e.target.result}" class="max-w-full max-h-full object-contain rounded-lg" alt="${file.name}">`;
          };
          reader.readAsDataURL(file);
        } else if (file.type.includes('pdf')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewContent.innerHTML = `
              <div class="text-center">
                <div class="text-6xl mb-4">üìÑ</div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">${file.name}</h3>
                <p class="text-gray-500 mb-4">PDF files cannot be previewed directly</p>
                <button onclick="downloadCurrentFile()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                  Download to View
                </button>
              </div>
            `;
          };
          reader.readAsDataURL(file);
        } else {
          previewContent.innerHTML = `
            <div class="text-center">
              <div class="text-6xl mb-4">${getFileIcon(file.type)}</div>
              <h3 class="text-lg font-medium text-gray-900 mb-2">${file.name}</h3>
              <p class="text-gray-500 mb-4">${getFileTypeLabel(file.type)} ‚Ä¢ ${formatFileSize(file.size)}</p>
              <button onclick="downloadCurrentFile()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                Download File
              </button>
            </div>
          `;
        }
        
        previewModal.classList.remove('hidden');
      }

      window.downloadCurrentFile = function() {
        if (currentPreviewFile) {
          const url = URL.createObjectURL(currentPreviewFile);
          const a = document.createElement('a');
          a.href = url;
          a.download = currentPreviewFile.name;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      };

      // Event listeners
      selectFilesBtn.addEventListener('click', () => orderAttachments.click());
      addMoreFilesBtn.addEventListener('click', () => orderAttachments.click());
      clearAllFilesBtn.addEventListener('click', () => {
        selectedFiles = [];
        updateFileDisplay();
        updateFileInput();
      });

      orderAttachments.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileSelection(e.target.files);
        }
      });

      // Drag and drop functionality
      additionalAttachmentsZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        additionalAttachmentsZone.classList.add('border-blue-500', 'bg-blue-50');
      });

      additionalAttachmentsZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        additionalAttachmentsZone.classList.remove('border-blue-500', 'bg-blue-50');
      });

      additionalAttachmentsZone.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        additionalAttachmentsZone.classList.remove('border-blue-500', 'bg-blue-50');
        
        if (e.dataTransfer.files.length > 0) {
          handleFileSelection(e.dataTransfer.files);
        }
      });

      // Preview modal close handlers
      closePreviewBtn.addEventListener('click', () => {
        previewModal.classList.add('hidden');
        currentPreviewFile = null;
      });

      previewDownloadBtn.addEventListener('click', downloadCurrentFile);

      // Close modal when clicking outside
      previewModal.addEventListener('click', (e) => {
        if (e.target === previewModal) {
          previewModal.classList.add('hidden');
          currentPreviewFile = null;
        }
      });

      // Mobile responsive enhancements
      function updateMobileLayout() {
        const isMobile = window.innerWidth < 768;
        
        if (isMobile) {
          // Make file list more mobile-friendly
          filesList.classList.add('space-y-1');
          // Adjust modal size for mobile
          const modalContent = previewModal.querySelector('.bg-white');
          modalContent.classList.add('mx-2', 'my-4');
        }
      }

      window.addEventListener('resize', updateMobileLayout);
      updateMobileLayout();

      // Mobile Navigation Functionality
      const mobileNavToggle = document.getElementById('mobileNavToggle');
      const mobileNavMenu = document.getElementById('mobileNavMenu');
      const closeMobileNav = document.getElementById('closeMobileNav');
      const sidebar = document.getElementById('sidebar');
      const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

      // Toggle mobile navigation
      if (mobileNavToggle) {
        mobileNavToggle.addEventListener('click', () => {
          mobileNavMenu.classList.add('active');
          document.body.style.overflow = 'hidden'; // Prevent background scrolling
        });
      }

      // Close mobile navigation
      if (closeMobileNav) {
        closeMobileNav.addEventListener('click', () => {
          mobileNavMenu.classList.remove('active');
          document.body.style.overflow = 'auto';
        });
      }

      // Close mobile nav when clicking outside
      if (mobileNavMenu) {
        mobileNavMenu.addEventListener('click', (e) => {
          if (e.target === mobileNavMenu) {
            mobileNavMenu.classList.remove('active');
            document.body.style.overflow = 'auto';
          }
        });
      }

      // Mobile logout functionality
      if (mobileLogoutBtn) {
        mobileLogoutBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to logout?')) {
            logout();
          }
        });
      }

      // Handle responsive sidebar behavior
      function handleSidebarResponsive() {
        const isMobile = window.innerWidth < 768;
        
        if (isMobile) {
          sidebar.classList.add('mobile-sidebar');
        } else {
          sidebar.classList.remove('mobile-sidebar', 'active');
          mobileNavMenu.classList.remove('active');
          document.body.style.overflow = 'auto';
        }
      }

      // Enhanced navigation for both mobile and desktop
      const allNavItems = document.querySelectorAll('.nav-item');
      allNavItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Remove active class from all nav items
          allNavItems.forEach(navItem => {
            navItem.classList.remove('active');
            navItem.style.backgroundColor = '';
            navItem.style.color = '';
          });
          
          // Add active class to clicked item
          item.classList.add('active');
          
          // Close mobile menu if open
          if (mobileNavMenu.classList.contains('active')) {
            mobileNavMenu.classList.remove('active');
            document.body.style.overflow = 'auto';
          }
          
          // Hide all page sections
          Object.values(pageSections).forEach(sec => sec.style.display = 'none');
          
          // Show target page
          const targetPage = item.dataset.page;
          if (pageSections[targetPage]) {
            pageSections[targetPage].style.display = '';
          }
          
          // Update page title based on active section
          const pageTitle = targetPage.charAt(0).toUpperCase() + targetPage.slice(1);
          document.title = `${pageTitle} - Fashion Admin Dashboard`;
        });
      });

      // Initial responsive setup
      window.addEventListener('resize', handleSidebarResponsive);
      handleSidebarResponsive();

      // Touch-friendly enhancements for mobile devices
      if ('ontouchstart' in window) {
        // Add touch-friendly classes
        document.body.classList.add('touch-device');
        
        // Improve tap targets for small elements
        const buttons = document.querySelectorAll('button, .btn, .nav-item');
        buttons.forEach(btn => {
          btn.style.minHeight = '48px';
          btn.style.minWidth = '48px';
        });
        
        // Add haptic feedback simulation for better UX
        buttons.forEach(btn => {
          btn.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
          });
          
          btn.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
          });
        });
      }

      // Accessibility improvements
      document.addEventListener('keydown', (e) => {
        // ESC key closes mobile menu
        if (e.key === 'Escape' && mobileNavMenu.classList.contains('active')) {
          mobileNavMenu.classList.remove('active');
          document.body.style.overflow = 'auto';
        }
      });

      // Progressive Web App features
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }

      // Enhanced file upload for mobile devices
      const fileInputs = document.querySelectorAll('input[type="file"]');
      fileInputs.forEach(input => {
        // Add capture attribute for mobile camera access
        if (input.accept && input.accept.includes('image')) {
          input.setAttribute('capture', 'environment');
        }
      });      // Optimize form interactions for mobile
      const formInputs = document.querySelectorAll('input, textarea, select');
      formInputs.forEach(input => {
        // Prevent zoom on focus for iOS
        input.style.fontSize = '16px';
        
        // Add better mobile keyboard types
        if (input.type === 'email') {
          input.setAttribute('inputmode', 'email');
        } else if (input.type === 'tel') {
          input.setAttribute('inputmode', 'tel');
        } else if (input.type === 'number') {
          input.setAttribute('inputmode', 'numeric');
        }
      });
    });

    // --- TechPack Upload Functionality ---
    async function uploadTechpack(orderId, inputElement) {
      const file = inputElement.files[0];
      if (!file) return;

      // Validate file size
      if (file.size > 10 * 1024 * 1024) { // 10MB limit
        alert('File size exceeds 10MB limit');
        return;
      }

      // Show upload progress
      const button = inputElement.parentElement.querySelector('button');
      const originalText = button.textContent;
      button.textContent = 'Uploading...';
      button.disabled = true;

      try {
        if (cloudStorage) {
          console.log(`Uploading TechPack for order ${orderId}: ${file.name}`);
          
          const uploadedFile = await cloudStorage.uploadFile(file, file.name, 
            (progress) => {
              button.textContent = `${Math.round(progress)}%`;
            }
          );

          // Update order with techpack attachment
          const orderIndex = orders.findIndex(o => o.id === orderId);
          if (orderIndex !== -1) {
            orders[orderIndex].techpackAttachment = {
              id: uploadedFile.fileId,
              name: uploadedFile.name,
              url: uploadedFile.url,
              size: uploadedFile.size,
              type: uploadedFile.type
            };
            
            // Save updated orders
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Re-render orders table
            renderOrders();
            
            console.log(`TechPack uploaded successfully for order ${orderId}`);
            alert(`TechPack "${file.name}" uploaded successfully!`);
          }
        } else {
          alert('Cloud storage not available. Please login first.');
        }
      } catch (error) {
        console.error(`Failed to upload TechPack for order ${orderId}:`, error);
        alert(`Error uploading TechPack: ${error.message}`);
      } finally {
        button.textContent = originalText;
        button.disabled = false;
        inputElement.value = ''; // Clear the input
      }
    }

    // Make uploadTechpack globally accessible
    window.uploadTechpack = uploadTechpack;
  </script>
</body>
</html>
